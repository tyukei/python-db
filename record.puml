sequenceDiagram
    participant App as Application / Table
    participant TB as SimpleTable
    participant BT as BPlusTree
    participant BPM as BufferPoolManager
    participant BP as BufferPool
    participant DM as DiskManager

    %% 挿入開始
    App->>TB: insert(record)
    TB->>BT: BT.insert(key, value)
    BT->>BPM: fetch_root_page()
    BPM->>BP: check page_table / fetch_page()
    alt ページがメモリにない場合
        BPM->>DM: read_page_data(page_id)
        DM-->>BPM: ページデータ返却
        BPM->>BP: 割り当て・キャッシュ
    end
    BT->>BT: insert_internal(再帰的な挿入処理)
    note right of BT: ノードがオーバーフローした場合は\n分割処理を実施し、昇格キーを作成
    alt 分割が必要な場合
        BT->>BPM: create_page()（新ノード作成）
        BPM->>DM: allocate_page(), write_page_data
    end
    BT-->>TB: レコード挿入完了
